âœ… ä¸€ã€Scrcpy åŽŸç†æ¦‚è¿°
scrcpy çš„åŸºæœ¬å·¥ä½œæµç¨‹å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š

å®‰å“ç«¯ï¼šä½¿ç”¨ adb å¯åŠ¨ scrcpy-server è¿›ç¨‹

PC ç«¯ï¼šç”¨ FFmpeg + SDL æ¸²æŸ“è§†é¢‘æµ + æ¨¡æ‹Ÿè¾“å…¥äº‹ä»¶

æ•°æ®æµç¨‹å›¾ï¼š
+--------------+     adb push     +------------------+
|   PC (host)  | ---------------> | Android Device   |
|              |                 | (scrcpy-server)   |
|              | <---------------| (Video encoded)   |
|              |     stream      |                  |
|              |     (H.264)     |                  |
+--------------+                 +------------------+

    â†‘ç”¨æˆ·è¾“å…¥          â†“è§†é¢‘æµ
 æŽ§åˆ¶æŒ‡ä»¤ï¼ˆæŒ‰é”®ã€ç‚¹å‡»ç­‰ï¼‰
ðŸ§± äºŒã€Scrcpy æž¶æž„åˆ†å±‚å›¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰      â”‚   â† å¯é€‰ï¼Œå¦‚ scrcpy-gui
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         PC å®¢æˆ·ç«¯ä¸»ç¨‹åº     â”‚
â”‚  - æŽ¥æ”¶è§†é¢‘æµï¼ˆH.264ï¼‰      â”‚
â”‚  - è§£ç å¹¶æ¸²æŸ“ï¼ˆffmpeg + SDLï¼‰â”‚
â”‚  - æŽ¥æ”¶ç”¨æˆ·æ“ä½œï¼ˆé”®é¼ äº‹ä»¶ï¼‰ â”‚
â”‚  - é€šè¿‡ ADB å‘é€åˆ°æ‰‹æœº      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         ADB é€šé“ï¼ˆUSB/TCPï¼‰ â”‚ â† ç”¨äºŽä¼ è¾“è§†é¢‘æµå’Œè¾“å…¥æŽ§åˆ¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      å®‰å“è®¾å¤‡ä¸Šçš„ server    â”‚
â”‚  - scrcpy-server.jar        â”‚
â”‚  - é‡‡é›†å±å¹• MediaProjection â”‚
â”‚  - ç¼–ç æˆ H.264             â”‚
â”‚  - æŽ¥æ”¶ PC å‘æ¥çš„è¾“å…¥äº‹ä»¶   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ðŸ” ä¸‰ã€å…³é”®æ¨¡å—è¯¦è§£
1. Android ç«¯ï¼šscrcpy-server.jar
ç¼–è¯‘åŽä»¥ jar æ–‡ä»¶å½¢å¼å†…åµŒåœ¨ PC ç¨‹åºä¸­ï¼ˆPC ä¼šç”¨ adb push æŽ¨é€å®ƒåˆ°æ‰‹æœºä¸Šï¼‰

æ ¸å¿ƒåŠŸèƒ½ï¼š

ä½¿ç”¨ MediaProjection API æ•èŽ·å±å¹•

ä½¿ç”¨ MediaCodec ç¼–ç ä¸º H.264 è§†é¢‘æµ

å°†è§†é¢‘æ•°æ®å‘é€ç»™ PC

æŽ¥æ”¶ PC å‘æ¥çš„è¾“å…¥äº‹ä»¶å¹¶ä½¿ç”¨ InputManager æ³¨å…¥äº‹ä»¶

2. ADB é€šé“
é€šè¿‡ adb exec-out å¯åŠ¨ serverï¼Œç„¶åŽç”¨ adb ç«¯å£è½¬å‘ï¼ˆé»˜è®¤ 27183ï¼‰

ä½¿ç”¨ adb reverse æ˜ å°„å®‰å“ç«¯å£åˆ° PC æœ¬åœ°ç«¯å£ï¼Œå®žçŽ°åŒå‘é€šä¿¡

æ”¯æŒ USB å’Œ TCP/IP æ¨¡å¼ï¼ˆæ— çº¿è¿žæŽ¥ï¼‰

3. PC å®¢æˆ·ç«¯
ç”¨ C å®žçŽ°ï¼ˆè·¨å¹³å°ï¼Œä¾èµ– SDL å’Œ FFmpegï¼‰

æ ¸å¿ƒåŠŸèƒ½ï¼š

é€šè¿‡ socket æŽ¥æ”¶å®‰å“ç«¯çš„ H.264 è§†é¢‘æµ

ç”¨ FFmpeg è§£ç ã€SDL æ¸²æŸ“åˆ°çª—å£

æ•èŽ·é¼ æ ‡é”®ç›˜è¾“å…¥ï¼Œè½¬æ¢ä¸º Android è¾“å…¥äº‹ä»¶ï¼ˆé€šè¿‡ adb å‘é€ï¼‰

âš™ï¸ å››ã€æ‰©å±•åŠŸèƒ½æ”¯æŒï¼ˆå¯é€‰ï¼‰
å‰ªè´´æ¿åŒæ­¥ï¼ˆåŒå‘ï¼‰

æ–‡ä»¶æ‹–æ‹½ï¼ˆé€šè¿‡ adb pushï¼‰

å½•å±åŠŸèƒ½ï¼ˆé€šè¿‡æœ¬åœ°ä¿å­˜ H.264ï¼‰

å¤šè®¾å¤‡æ”¯æŒï¼ˆé€šè¿‡æŒ‡å®šåºåˆ—å·ï¼‰

ðŸ“Œ æ€»ç»“
æ¨¡å—	æŠ€æœ¯	ä½œç”¨
Android ç«¯	MediaProjection + MediaCodec	é‡‡é›†å¹¶åŽ‹ç¼©å±å¹•
ADB é€šé“	adb exec-out + socket	å»ºç«‹è¿žæŽ¥å’Œé€šä¿¡
PC ç«¯	FFmpeg + SDL + ADB	è§£ç ã€æ˜¾ç¤ºã€æŽ§åˆ¶ã€è¾“å…¥è½¬å‘

æ˜¯å¦éœ€è¦æˆ‘ç”»ä¸€å¼ å›¾å¸®åŠ©ä½ æ›´ç›´è§‚ç†è§£ scrcpy æž¶æž„ï¼Ÿæˆ–è€…ä½ æƒ³è‡ªå·±åŸºäºŽå®ƒåšäº›äºŒæ¬¡å¼€å‘ï¼Œæˆ‘å¯ä»¥å¸®ä½ æ‰¾å…¥å£ç‚¹ï¼ˆæ¯”å¦‚å¦‚ä½•æ”¹è¾“å…¥ã€å¦‚ä½•æ›¿æ¢ç¼–ç å™¨ç­‰ï¼‰ã€‚